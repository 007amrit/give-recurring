(()=>{var e=window.Give_Recurring_Vars;jQuery(document).ready((function(i){var n={init:function(){n.recurring_option=i('input[name="_give_recurring"]'),n.set_multi_level_recurring_limits(),n.toggle_set_recurring_fields(),n.toggle_multi_recurring_fields(),n.validate_times(),n.validate_period(),n.detect_email_access(),n.toggle_default_period(),n.set_custom_amount_recurring_limits(),n.set_recurring_limits(),n.toggle_custom_amount_fields(),i('input[name="_give_price_option"], input[name="_give_recurring"]').on("change",(function(){n.set_recurring_limits(),"set"===i('input[name="_give_price_option"]:checked').val()?n.toggle_set_recurring_fields():n.toggle_multi_recurring_fields()})),n.toggle_custom_amount_period(),i("body").on("change",".give-recurring-admin-choice-level",(function(){n.toggle_admin_choice_fields(i(this))})),i('select[name="_give_period_interval"], select[name="_give_period"],select[name="_give_period_default_donor_choice"], input[name="_give_period_functionality"]').on("change",(function(){var e=i(this).val();n.set_recurring_limits(e)})),i("body").on("change",".give-inline-row-period select, .give-inline-row-interval select",(function(){var e=i(this),r=e.val();n.set_multi_level_recurring_limits(e,r,"change")})),i(".give-add-repeater-field-section-row").on("click",(function(){var e=i(this);setTimeout((function(){var i=e.closest("table").find(" tbody tr:last-child");n.set_multi_level_recurring_limits(i,"month","add")}),100)}))},toggle_custom_amount_fields:function(){var e=i('input[name="_give_price_option"]:checked').val(),r=i('input[name="_give_recurring"]:checked').val(),t=i('input[name="_give_custom_amount"]:checked').val(),o=i('select[name="_give_recurring_custom_amount_period"]');"once"===o.val()&&o.parent().addClass("give-control-select-onetime"),"multi"===e&&"yes_admin"===r&&"enabled"===t?(n.set_custom_amount_recurring_limits(),i(".give_custom_recurring_all_options").show(),i(".give-recurring-custom-amount-period").show(),"once"!==i("#_give_recurring_custom_amount_period").val()&&(i(".give-recurring-custom-amount-times").show(),i("._give_recurring_custom_amount_interval_field").show())):(i(".give_custom_recurring_all_options").hide(),i(".give-recurring-custom-amount-period").hide(),i(".give-recurring-custom-amount-times").hide(),i("._give_recurring_custom_amount_interval_field").hide())},set_recurring_limits:function(n){i('[name^="_give_times"]').each((function(){var r,t=i(this),o=!1,a=i('input[name="_give_period_functionality"]:checked').val(),_=i('input[name="_give_recurring"]:checked').val(),c=parseInt(i("#_give_period_interval").val());r="donors_choice"===a&&"yes_donor"===_?"#_give_period_default_donor_choice":"#_give_period",t.empty();var l=i(r).val();0<=i.inArray(n,["day","week","month","quarter","year"])&&(l=n),i.each(e.billingLimits[l],(function(e,n){(0===parseInt(e)||0==parseInt(e)%c&&parseInt(e)!==c)&&t.append(i("<option></option>").attr("value",e).text(n))})),t.children("option").each((function(){if(this.value===e.selected_billing_limit)return o=!0,!1})),t.val(0),o&&t.val(e.selected_billing_limit)}))},set_multi_level_recurring_limits:function(n,r,t){var o;o="add"!==t&&"change"!==t?i("#_give_donation_levels_field table.give-repeatable-fields-section-wrapper tbody tr.give-row").not(".give-template"):n,"change"===t&&"undefined"!==i.type(n)&&(o=n.parent().closest("tr")),o.each((function(n){var o,a=i(this).find(".give-inline-row-limit select"),_=!1,c=a.attr("name").match(/\[(.*?)\]/),l=i.parseJSON(e.selected_multilevel_billing_limit),g=parseInt(i("#_give_period_interval").val());if(!c)return!1;o='[name="_give_donation_levels['+c[1]+'][_give_period]"]',g=parseInt(i('[name="_give_donation_levels['+c[1]+'][_give_period_interval]"]').val()),a.empty();var u=i(o).val();0<=i.inArray(r,["day","week","month","year"])&&(u=r),i.each(e.billingLimits[u],(function(e,n){(0===parseInt(e)||0==parseInt(e)%g&&parseInt(e)!==g)&&a.append(i("<option></option>").attr("value",e).text(n))}));var s=0;"add"!==t&&"change"!==t&&""!==l[n]&&(s=l[n]),a.children("option").each((function(){if(this.value===s)return _=!0,!1})),a.val(0),_&&a.val(s)}))},set_custom_amount_recurring_limits:function(n){i('[name^="_give_recurring_custom_amount_times"]').each((function(){var r=i(this),t=!1,o=parseInt(i("#_give_recurring_custom_amount_interval").val());r.empty();var a=i("#_give_recurring_custom_amount_period").val();0<=i.inArray(n,["day","week","month","year"])&&(a=n),i.each(e.billingLimits[a],(function(e,n){(0===parseInt(e)||0==parseInt(e)%o&&parseInt(e)!==o)&&r.append(i("<option></option>").attr("value",e).text(n))})),r.children("option").each((function(){if(this.value===e.selected_custom_amount_billing_limit)return t=!0,!1})),r.val(0),t&&r.val(e.selected_custom_amount_billing_limit)}))},toggle_custom_amount_period:function(){i('input[name="_give_price_option"], input[name="_give_custom_amount"], input[name="_give_recurring"]').on("change",(function(){n.toggle_custom_amount_fields()})),i("#_give_recurring_custom_amount_period").on("change",(function(){var e=i(this),r=e.val();"once"!==r?(n.set_custom_amount_recurring_limits(r),i(".give-recurring-custom-amount-times").show(),i("._give_recurring_custom_amount_interval_field").show(),e.parent().removeClass("give-control-select-onetime")):(i(".give-recurring-custom-amount-times").hide(),i("._give_recurring_custom_amount_interval_field").hide(),e.parent().addClass("give-control-select-onetime"))})),i("#_give_recurring_custom_amount_interval").on("change",(function(){var e=i(this).val();n.set_custom_amount_recurring_limits(e)}))},toggle_default_period:function(){i('input[name="_give_period_functionality"]').on("change",(function(){var e=i(this).filter(":checked").val();"donors_choice"===e?(i(".give-recurring-period").hide(),i(".give-recurring-period-default-choice").show()):"admin_choice"===e&&(i(".give-recurring-period").show(),i(".give-recurring-period-default-choice").hide())})).change()},toggle_set_recurring_fields:function(){var e=n.recurring_option.filter(":checked").val();if("set"!==i('input[name="_give_price_option"]:checked').val())return!1;"yes_admin"===e?(i(".give-recurring-row.give-hidden").show(),i(".give-recurring-checkbox-option").hide(),i(".give-recurring-period-default-choice").hide(),i(".give-recurring-period-functionality").hide()):"yes_donor"===e?(i(".give-recurring-row.give-hidden").show(),i(".give-recurring-checkbox-option").show(),i(".give-recurring-period-default-choice").show(),i(".give-recurring-period-functionality").show(),n.toggle_default_period()):i(".give-recurring-row.give-hidden").hide()},toggle_multi_recurring_fields:function(){var e=i('input[name="_give_price_option"]:checked').val(),r=n.recurring_option.filter(":checked").val();if("multi"!==e)return!1;"yes_admin"===r?(i(".give-recurring-row.give-hidden").hide(),i(".give-recurring-multi-el").show(),i(".give-recurring-admin-choice-level-row").each((function(){n.toggle_admin_choice_fields(i(this).find(".give-recurring-admin-choice-level"))}))):"yes_donor"===r?(i(".give-recurring-row.give-hidden").show(),i(".give-recurring-multi-el").hide(),n.toggle_default_period()):"no"===r&&(i(".give-recurring-row.give-hidden").hide(),i(".give-recurring-multi-el").hide())},toggle_admin_choice_fields:function(e){var i=e.filter(":checked").val(),n=e.parents(".give-row-body").find('[name$="[_give_period]"], [name$="[_give_times]"], [name$="[_give_period_interval]"]');"yes"===i?n.parent(".give-field-wrap").show():n.parent(".give-field-wrap").hide()},validate_times:function(){i(".give-billing-time-field").on("change",(function(){var r=i(this).val();if("no"===n.recurring_option.filter(":checked").val())return!1;void 0!==e.enabled_gateways.paypal&&1===r&&(alert(e.invalid_time.paypal),i(this).val("2"),i(this).focus())}))},validate_period:function(){i(".give-period-field").on("change",(function(){var r=i(this).val();if("no"===n.recurring_option.filter(":checked").val())return!1;"day"===r&&(void 0!==e.enabled_gateways.authorize?(alert(e.invalid_period.authorize),i(this).val("month")):void 0!==e.enabled_gateways.wepay?(alert(e.invalid_period.wepay),i(this).val("month")):void 0!==e.enabled_gateways.gocardless&&(alert(e.invalid_period.gocardless),i(this).val("month")),i(this).focus())}))},detect_email_access:function(){var r=n.recurring_option.filter(":checked").val();e.email_access||"no"===r||n.toggle_login_message("on"),n.recurring_option.on("change",(function(){"no"!==i(this).val()?n.toggle_login_message("on"):n.toggle_login_message("off")}))},toggle_login_message:function(n){var r=i("._give_show_register_form_field"),t=i(".give-recurring-login-required");"on"===n&&0===t.length?(r.addClass("recurring-email-access-message"),r.before(e.messages.login_required)):"off"===n&&(r.removeClass("recurring-email-access-message"),t.remove())}};n.init()}))})();